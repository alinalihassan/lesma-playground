name: Push to GCR GitHub Action
on: 
  push:
    branches:
      - master
jobs:
  build-and-push-to-gcr:
    name: "Bulding and pushing images"
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - id: 'auth'
        uses: 'google-github-actions/auth@v0'
        with:
          credentials_json: '${{ secrets.GOOGLE_CREDENTIALS }}'

      - name: Set up Cloud SDK
        uses: 'google-github-actions/setup-gcloud@v0'

      - name: Build image to GCR
        run: gcloud builds submit --tag gcr.io/${{ secrets.GOOGLE_CLOUD_PROJECT }}/lesma-playground --verbosity=debug

      - id: 'deploy'
        uses: 'google-github-actions/deploy-cloudrun@v0'
        with:
          service: 'lesma-playground'
          image: 'gcr.io/${{ secrets.GOOGLE_CLOUD_PROJECT }}/lesma-playground'